<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width,initial-scale=1.0">
		<link rel="icon" href="<%= BASE_URL %>favicon.ico">
		<link 
			rel="stylesheet" 
			href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" 
			integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" 
			crossorigin="anonymous"
		>
		<title>tar_front</title>
	</head>
	<body>
		<noscript>
		<strong>We're sorry but tar_front doesn't work properly without JavaScript enabled. Please enable it to continue.</strong>
		</noscript>
        <!--div id="app"></div-->
        <div class="container">
            <div class="row">
                <div class="col-12 text-center">
                    <h3>Платёжное поручение</h3>
                </div>
                
                <form class="row">
                    <div class="form-group col-4">
                        <label>Номер документа</label>
                        <input type="text" class="form-control form-control-sm" id="docNo">
                    </div>
                    <div class="form-group col-4">
                        <label>Дата составления</label>
                        <input type="text" class="form-control form-control-sm" id="docDate">
                    </div>
                    <div class="form-group col-4">
                        <label>Сумма документа</label>
                        <input type="text" class="form-control form-control-sm" id="sum">
                    </div>
                    
                    <div class="form-group col-3">
                        <label>Вид платежа</label>
                        <input type="text" class="form-control form-control-sm" id="paymentKind">
                    </div>
        
                    <div class="form-group col-3">
                        <label>Вид операции</label>
                        <input type="text" class="form-control form-control-sm" id="transitionKind">
                    </div>
        
                    <div class="form-group col-3">
                        <label data-toggle="tooltip" data-placement="top" title="Очередность платежа">Оч-ть платежа</label>
                        <input type="text" class="form-control form-control-sm" id="priority">
                    </div>
        
                    <div class="form-group col-3">
                        <label data-toggle="tooltip" data-placement="top" title="Уникальный идентификатор платежа">УИП</label>
                        <input type="text" class="form-control form-control-sm" id="code">
                    </div>
        
                    <div class="form-group col-12">
                        <label>Назначение платежа</label>
                        <input type="text" class="form-control form-control-sm" id="purpose">
                    </div>
        
        
                    <div class="col-12 text-center">
                        <h6>Плательщик</h6>
                    </div>
                    <div class="form-group col-6">
                        <label>Наименование</label>
                        <input type="text" class="form-control form-control-sm" id="payer_name">
                    </div>
                    <div class="form-group col-6">
                        <label>Расчётный счёт</label>
                        <input type="text" class="form-control form-control-sm" id="payer_account">
                    </div>
                    <div class="form-group col-4">
                        <label>ИНН</label>
                        <input type="text" class="form-control form-control-sm" id="payer_inn">
                    </div>
                    <div class="form-group col-4">
                        <label>КПП</label>
                        <input type="text" class="form-control form-control-sm" id="payer_kpp">
                    </div>
                    <div class="form-group col-4">
                        <label>БИК Банка</label>
                        <input type="text" class="form-control form-control-sm" id="payer_bank_bic">
                    </div>
                    <div class="form-group col-4">
                        <label>Наименование Банка</label>
                        <input type="text" class="form-control form-control-sm" id="payer_bank_name" placeholder="заполняется только в поручении на бумаге">
                    </div>
                    <div class="form-group col-4">
                        <label>Город Банка</label>
                        <input type="text" class="form-control form-control-sm" id="payer_bank_city">
                    </div>
                    <div class="form-group col-4">
                        <label>Корреспондентский счёт</label>
                        <input type="text" class="form-control form-control-sm" id="payer_bank_correspAcc">
                    </div>
        
                    <div class="col-12 text-center">
                        <h6>Получатель</h6>
                    </div>
                    <div class="form-group col-6">
                        <label>Наименование</label>
                        <input type="text" class="form-control form-control-sm" id="payee_name">
                    </div>
                    <div class="form-group col-6">
                        <label>Расчётный счёт</label>
                        <input type="text" class="form-control form-control-sm" id="payee_account">
                    </div>
                    <div class="form-group col-4">
                        <label>ИНН</label>
                        <input type="text" class="form-control form-control-sm" id="payee_inn">
                    </div>
                    <div class="form-group col-4">
                        <label>КПП</label>
                        <input type="text" class="form-control form-control-sm" id="payee_kpp">
                    </div>
                    <div class="form-group col-4">
                        <label>БИК Банка</label>
                        <input type="text" class="form-control form-control-sm" id="payee_bank_bic">
                    </div>
                    <div class="form-group col-4">
                        <label>Наименование Банка</label>
                        <input type="text" class="form-control form-control-sm" id="payee_bank_name" placeholder="заполняется только в поручении на бумаге">
                    </div>
                    <div class="form-group col-4">
                        <label>Город Банка</label>
                        <input type="text" class="form-control form-control-sm" id="payee_bank_city">
                    </div>
                    <div class="form-group col-4">
                        <label>Корреспондентский счёт</label>
                        <input type="text" class="form-control form-control-sm" id="payee_bank_correspAcc">
                    </div>

                    <div class="form-check col-12">
                        <input class="form-check-input" type="checkbox" value="" id="budget">
                        <label class="form-check-label" for="defaultCheck1">
                            Бюджетное ПП
                        </label>
                    </div>

                    <div class="form-group col-3 budget" style="display: none">
                        <label>КБК</label>
                        <input type="text" class="form-control form-control-sm" id="b_kbk">
                    </div>
                    
                    <div class="form-group col-3 budget" style="display: none">
                        <label>Статус составителя</label>
                        <input type="text" class="form-control form-control-sm" id="b_DrawerStatus">
                    </div>

                    <div class="form-group col-3 budget" style="display: none">
                        <label>OKTMO</label>
                        <input type="text" class="form-control form-control-sm" id="b_oktmo">
                    </div>

                    <div class="form-group col-3 budget" style="display: none">
                        <label>Основание платежа</label>
                        <input type="text" class="form-control form-control-sm" id="b_reason">
                    </div>

                    <div class="form-group col-3 budget" style="display: none">
                        <label>Налоговый период</label>
                        <input type="text" class="form-control form-control-sm" id="b_TaxPeriod">
                    </div>

                    <div class="form-group col-3 budget" style="display: none">
                        <label>Номер документа</label>
                        <input type="text" class="form-control form-control-sm" id="b_DocNo">
                    </div>

                    <div class="form-group col-3 budget" style="display: none">
                        <label>Дата документа</label>
                        <input type="text" class="form-control form-control-sm" id="b_DocDate">
                    </div>

                    <div class="form-group col-3 budget" style="display: none">
                        <label>Тип платежа</label>
                        <input type="text" class="form-control form-control-sm" id="b_PayType">
                    </div>

                    
                    <div class="col-12">
                        <button type="button" class="btn btn-primary btn-block" id="send_form">Submit</button>
                    </div>
                </form>
            </div>
        </div>
		<!-- built files will be auto injected -->
		<!--script 
			src="https://code.jquery.com/jquery-3.3.1.slim.min.js" 
			integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" 
			crossorigin="anonymous">
        </script-->
        
        <script
            src="https://code.jquery.com/jquery-3.3.1.js"
            integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
            crossorigin="anonymous">
        </script>
		<script 
			src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" 
			integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" 
			crossorigin="anonymous">
		</script>
		<script 
			src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" 
			integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" 
			crossorigin="anonymous">
        </script>
        <script>
            $(document).ready(function(){
                //$(".btn-slide").click(function(){
                //  $("#panel").slideToggle("slow");
                //    $(this).toggleClass("active");
                //});
                /*function is_empty_field( str ){
                    if ( str.length == 0 ){
                        return null
                    } else {
                        return str
                    }
                }*/
                $('#budget').click(function(){
                    //alert( $("#budget").prop("checked") );
                    if ( $("#budget").prop("checked") ){
                        $('.budget').show();
                    } else {
                        $('.budget').hide();
                    }
                    
                })

                $('#send_form').click(function(){
                    //alert('hg');
                    var payment = {
                        docNo:                 $('#docNo').val(),
                        docDate:               $('#docDate').val(),
                        sum:                   $('#sum').val(),
                        payer_name:            $('#payer_name').val(),
                        payer_inn:             $('#payer_inn').val(),
                        payer_kpp:             $('#payer_kpp').val(),
                        payer_account:         $('#payer_account').val(),
                        payer_bank_bic:        $('#payer_bank_bic').val(),
                        payer_bank_name:       $('#payer_bank_name').val(),
                        payer_bank_city:       $('#payer_bank_city').val(),
                        payer_bank_correspAcc: $('#payer_bank_correspAcc').val(),
                        payee_name:            $('#payee_name').val(),
                        payee_inn:             $('#payee_inn').val(),
                        payee_kpp:             $('#payee_kpp').val(),
                        payee_account:         $('#payee_account').val(),
                        payee_bank_bic:        $('#payee_bank_bic').val(),
                        payee_bank_name:       $('#payee_bank_name').val(),
                        payee_bank_city:       $('#payee_bank_city').val(),
                        payee_bank_correspAcc: $('#payee_bank_correspAcc').val(),
                        paymentKind:           $('#paymentKind').val(),
                        transitionKind:        $('#transitionKind').val(),
                        priority:              $('#priority').val(),
                        code:                  $('#code').val(),
                        purpose:               $('#purpose').val(),

                        //test: null
                    }
                    
                    //console.log( payment )

                    var json_for_send = {}

                    for ( var key in payment ){
                        if ( payment[key].length > 0 ){
                            json_for_send[key] = payment[key]
                        }
                    }

                    if ( $("#budget").prop("checked") ){
                        //json_for_send['b_kbk'] = $('#b_kbk').val();
                        json_for_send['is_budget'] = 1;

                        var templ = [ 'b_kbk', 'b_DrawerStatus', 'b_oktmo', 'b_reason', 'b_TaxPeriod', 'b_DocNo', 'b_DocDate', 'b_PayType' ]

                        for (var i=0;i<templ.length;i++){
                            if ( $( '#' + templ[i] ).val().length > 0 ){
                                json_for_send[ templ[i] ] = $( '#' + templ[i] ).val();    
                            }
                        }

                        /*if ( $('#b_kbk').val().length > 0 ){
                            json_for_send['b_kbk'] = $('#b_kbk').val();    
                        }*/
                    }

                    console.log( json_for_send )

                    $.ajax({
                        type: "POST",
                        url:         "/paydoc",
                        data:        JSON.stringify( json_for_send ),
                        contentType: "application/json; charset=utf-8",
                        dataType:    "json",
                        success: function(data){
                            //alert(location);
                            console.log( data )

                            window.open('/info/'+data.doc_id);
                        },
                        failure: function(errMsg) {
                            alert(errMsg);
                        }
                    });
                })

            });
        
        </script>
	</body>
</html>
